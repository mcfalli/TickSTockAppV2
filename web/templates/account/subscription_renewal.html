<!DOCTYPE html>
<html>
<head>
    <title>Renew Subscription - TickStock</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/auth.css') }}">
</head>
<body>
    <div class="navbar">
        <h1>TickStock</h1>
        <div class="navbar-right">
            <span class="support-email">support@tickstock.com</span>
        </div>
    </div>
    <div class="container">
        <div class="auth-panel">
            <h2>Renew Your Subscription</h2>
            <p>Welcome back, {{ user.username }}! Your subscription has expired. Please update your information and renew to continue.</p>
            
            {% with messages = get_flashed_messages() %}
                {% if messages %}
                    <ul class="flash-messages">
                        {% for message in messages %}
                            <li>{{ message }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
            {% endwith %}
            
            <form method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                {{ form.hidden_tag() }}
                <fieldset>
                    <legend>Contact Information</legend>
                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" id="email" name="email" value="{{ user.email }}" class="form-control" readonly>
                    </div>
                    <div class="form-group">
                        {{ form.phone.label(class="form-label") }}
                        {{ form.phone(class="form-control", placeholder="Enter phone number") }}
                        {% if form.phone.errors %}
                            <div class="error">
                                {% for error in form.phone.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Billing Address</legend>
                    <div class="form-group">
                        {{ form.address_line1.label(class="form-label") }} <span class="required">*</span>
                        {{ form.address_line1(class="form-control") }}
                        {% if form.address_line1.errors %}
                            <div class="error">
                                {% for error in form.address_line1.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    <div class="form-group">
                        {{ form.address_line2.label(class="form-label") }}
                        {{ form.address_line2(class="form-control") }}
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            {{ form.city.label(class="form-label") }} <span class="required">*</span>
                            {{ form.city(class="form-control") }}
                            {% if form.city.errors %}
                                <div class="error">
                                    {% for error in form.city.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        <div class="form-group">
                            {{ form.state_province.label(class="form-label") }}
                            {{ form.state_province(class="form-control") }}
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            {{ form.postal_code.label(class="form-label") }} <span class="required">*</span>
                            {{ form.postal_code(class="form-control") }}
                            {% if form.postal_code.errors %}
                                <div class="error">
                                    {% for error in form.postal_code.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        <div class="form-group">
                            {{ form.country.label(class="form-label") }} <span class="required">*</span>
                            {{ form.country(class="form-control") }}
                            {% if form.country.errors %}
                                <div class="error">
                                    {% for error in form.country.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Payment Information</legend>
                    <div class="form-group">
                        {{ form.card_number.label(class="form-label") }} <span class="required">*</span>
                        {{ form.card_number(class="form-control", placeholder="1234 5678 9012 3456", maxlength="19") }}
                        {% if form.card_number.errors %}
                            <div class="error">
                                {% for error in form.card_number.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            {{ form.expiry.label(class="form-label") }} <span class="required">*</span>
                            {{ form.expiry(class="form-control", placeholder="MM/YY", maxlength="5") }}
                            {% if form.expiry.errors %}
                                <div class="error">
                                    {% for error in form.expiry.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        <div class="form-group">
                            {{ form.cvv.label(class="form-label") }} <span class="required">*</span>
                            {{ form.cvv(class="form-control", placeholder="123", maxlength="4") }}
                            {% if form.cvv.errors %}
                                <div class="error">
                                    {% for error in form.cvv.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </fieldset>

                <div class="subscription-summary">
                    <h3>Subscription Summary</h3>
                    <p><strong>Plan:</strong> Premium Monthly</p>
                    <p><strong>Price:</strong> $29.99/month</p>
                    <p><strong>Next billing:</strong> 30 days from activation</p>
                </div>

                <div class="form-group">
                    <label>{{ form.captcha_response }} I am not a robot (stub)</label>
                    {% if form.captcha_response.errors %}
                        <div class="error">
                            {% for error in form.captcha_response.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                {{ form.submit(class="btn btn-primary") }}
            </form>
            
            <p style="margin-top: 20px;">
                <a href="{{ url_for('login') }}">← Back to Login</a>
            </p>
        </div>
    </div>
    <div class="status-bar">
        <div class="status-bar-left">
            <small>© 2025 TickStock</small>
        </div>
    </div>

    <script>
        // Format card number input
        document.getElementById('card_number').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
            let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
            e.target.value = formattedValue;
        });

        // Format expiry input
        document.getElementById('expiry').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length >= 2) {
                value = value.substring(0, 2) + '/' + value.substring(2, 4);
            }
            e.target.value = value;
        });

        // Restrict CVV to numbers only
        document.getElementById('cvv').addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/\D/g, '');
        });
    </script>
</body>
</html>